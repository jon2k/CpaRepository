@model IEnumerable<CpaRepository.ViewModel.AgreedModules.AgreedModuleViewModel>

@{
    ViewData["Title"] = "Актуальные согласованные модули";
}

<h1>Актуальные согласованные модули</h1>

<div class="row">
    <div class="col-md-4">
        <label class="control-label">Вендор</label>
        <select class="form-control" asp-items="ViewBag.VendorId" id="vendor"></select>
    </div>
    <div class="col-md-4">
        <label class="control-label">ТПР модуль</label>
        <select class="form-control" asp-items="ViewBag.CpaModuleId" id="cpaModules"></select>
    </div>
</div>
<table class="table" id="vendorModules">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Vendor.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.VendorModule.NameModule)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Version)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CRC)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.DateOfLetter)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Letter.NumberLetter)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Changes)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ExistModule)
            </th>

        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Vendor.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.VendorModule.NameModule)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Version)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.CRC)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.DateOfLetter)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Letter.NumberLetter)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Changes)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ExistModule)
                </td>

            </tr>
        }
    </tbody>
</table>

@section scripts{
    <script type="text/javascript">
    $(function () {

        $('#vendor').change(function()
        {
            // получаем выбранный id
            var id = $(this).val();
            var id2 = $("#cpaModules").val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetActualModules")/',
                data: {
                    SelectedVendor: id,
                    SelectedCpaModule: id2
                },
                success: function (data) {

                    // заменяем содержимое присланным частичным представлением
                    $('#vendorModules').replaceWith(data);
                }
            });

        });
         $('#cpaModules').change(function()
        {
            // получаем выбранный id
            var id2 = $(this).val();
            var id = $("#vendor").val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetActualModules")/',
                data: {
                    SelectedVendor: id,
                    SelectedCpaModule: id2
                },
                success: function (data) {

                    // заменяем содержимое присланным частичным представлением
                    $('#vendorModules').replaceWith(data);
                }
            });

        });
    })
    </script>
}
